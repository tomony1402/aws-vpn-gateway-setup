# aws-vpn-gateway-setup

オンプレミスの分散配信機とAWS環境をVPNで接続し、プライベートIPでの通信を可能にする基盤構築の記録。

## 1. 構成概要
- **オンプレ側**: 分散配信機
- **AWS側**: VPNサーバー (AlmaLinux 9)
- **目的**: 拠点間をプライベートIPで接続し、セキュアな配信環境を構築する。

## 2. ネットワーク設計
セグメントを分離し、ルーティングとDNSによってセキュアな通信を確保。

- **ネットワーク構成**: 
    - AWS VPC（VPNサーバー用セグメント）
    - オンプレミス/他環境（配信機用セグメント）
    ※ 両環境のVPC/ネットワークは分離して運用。
- **VPN接続方式**: StrongSwan (IPsec VPN)
- **名前解決**: 
    - オンプレミス側のDNSにて、配信機のプライベートIPを返すよう構成。
    - これにより、VPNトンネル経由でのセキュアなプライベート通信を実現。
 
### 2.1 VPCピアリングとルーティングの構成
VPNサーバーがあるVPCと、配信機が接続する先のVPCが異なるため、以下の設定を実装：
- **VPC Peering**: 2つのVPC間を接続。
- **Route Tableの更新**: 
    - VPN VPC側：オンプレ向けの戻り通信をピアリングへ流す。
    - 配信先 VPC側：オンプレ向けのルートをピアリングへ流す。
- **StrongSwanのLeft/Right Subnet設定**: ピアリング先のセグメントも含めるように定義。
